---
sidebar_position: 0
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import TOCInline from '@theme/TOCInline';
import styles from '../../../../src/scss/_textStyle.module.scss';
import azLandingZoneBasic1 from './img/az_img/az-lz-basic/1.png';
import azLandingZoneBasic2 from './img/az_img/az-lz-basic/2.png';
import azLandingZoneBasic3 from './img/az_img/az-lz-basic/3.png';
import azLandingZoneBasic4 from './img/az_img/az-lz-basic/4.png';
import azLandingZoneBasic5 from './img/az_img/az-lz-basic/5.png';
import azLandingZoneBasic6 from './img/az_img/az-lz-basic/6.png';
import azLandingZoneBasic7 from './img/az_img/az-lz-basic/7.png';
import azLandingZoneBasic8 from './img/az_img/az-lz-basic/8.png';
import azLandingZoneBasic9 from './img/az_img/az-lz-basic/9.png';
import azLandingZoneBasic10 from './img/az_img/az-lz-basic/10.png';
import azLandingZoneBasic11 from './img/az_img/az-lz-basic/11.png';


# Azure
##### 2022.07.18 / 읽는 데 15분 걸림(소요시간)

*****

## 전제조건
- **Azure 구독**
- **Azure 서비스 주체 + 역할 할당**
- **리소스를 배포하는 구독에 대해 기여자 이상의 권한**

:::info
서비스 주체를 사용하기 위해서는 생성한 서비스 주체는 구독의 IAM 엑세스 제어에 추가해야 합니다. 
역할을 할당할 때는, Azure에서 제공하는 Buildin 규칙과 사용자가 필요한 권한을 추가하는 Custom 규칙이 있습니다.
Cloud Studio를 안정적으로 사용하기 위해서는 구독의 소유자(Owner) 권한을 권장합니다. 하지만, 소유자 권한을 사용할 수 없다면
최소 기여자(Contributor) 권한이 필요합니다. 기여자 권한은 관리자 바로 아래 권한으로 구독의 권한 할당을 제외한 모든 작업이 가능합니다.
(Azure 역할 할당: https://docs.microsoft.com/ko-kr/azure/role-based-access-control/role-assignments-cli)
:::
 
## 구성 서비스
- **Virtual Network**: Azure 리소스 간 통신이나 인터넷 및 특정 온-프레미스 네트워크와 통신을 위한 기본 구성요소
- **Subnet**: Azure 리소스를 Virtual Network에 배포하기 위해 Virtual Network 내에 생성하는 네트워크
- **Virtual Network Peering**: 서로 다른 Virtual Network를 연결하는 리소스
- **Network Security Group**: Virtual Network의 Azure 리소스와 주고받는 네트워크 트래픽을 필터링하는 리소스
- **Firewall**: 클라우드 워크로드에 대해 위협 보호를 제공하는 지능형 네트워크 방화벽 보안 서비스
- **Virtual Machine**: 실제 하드웨어를 관리하지 않아도 가상화의 유연성을 제공하는 컴퓨팅 리소스
- **Storage Account**: HTTP, HTTPS를 통해 Storage 데이터에 대한 고유한 네임스페이스를 제공하고 저장소를 지원하는 서비스
- **Key Vault**: 암호를 안전하게 저장하고 액세스 하기 위한 클라우드 서비스
- **Automation Account**: 일관된 관리를 지원하는 클라우드 기반 자동화, 운영 체제 업데이트 및 구성 서비스를 제공하는 기능
<br/>

## Architecture
<caption caption="[그림.1] Azure Landing Zone Basic" src={azLandingZoneBasic11} />


## 캔버스 실습
### 구독 지정
- 리소스를 배포할 구독을 지정합니다.
- 해당 구독에서 사용가능한 서비스 주체의 Secret 값을 입력합니다.
<caption caption="[그림.2] Azure Landing Zone Basic 1" src={azLandingZoneBasic1} /><br/>
### 리소스 그룹 생성
- 리소스 그룹은 같은 lifecycle을 가진 리소스들의 묶음 입니다.
- 랜딩존 Basic에서는 모든 리소스를 같은 리소스 그룹에 생성합니다.
- 리소스 그룹의 Region은 <highlight color="#D0D0D0">koreacentral</highlight>을 선택합니다.
<caption caption="[그림.3] Azure Landing Zone Basic 2" src={azLandingZoneBasic2} /><br/>
### 가상 네트워크 생성
- 리소스를 배포할 가상 네트워크를 2개 생성합니다.
- 왼쪽 가상 네트워크는 트래픽을 필터링하는 Hub Vnet입니다.
- 오른쪽 가상 네트워크는 애플리케이션이 동작하는 Vnet입니다.
- 각 가상 네트워크의 CIDR은 아래와 같이 설정합니다.
  - Hub Vnet: <highlight color="#D0D0D0">10.0.0.0/16</highlight>
  - Application Vnet: <highlight color="#D0D0D0">10.1.0.0/16</highlight>
<caption caption="[그림.4] Azure Landing Zone Basic 3" src={azLandingZoneBasic3} /><br/>
### 가상 네트워크 피어링 생성
- 가상 네트워크 피어링은 서로 다른 가상 네트워크를 연결하는 서비스 입니다.
- Hub Vnet과 Application Vnet은 서로 다른 IP 대역을 가지고 있기 때문에 피어링을 하지 않으면 통신할 수 없습니다.
- Hub Vnet과 Application Vnet을 피어링으로 연결합니다.
<caption caption="[그림.5] Azure Landing Zone Basic 4" src={azLandingZoneBasic4} /><br/>
### 서브넷 생성
- 서브넷은 IP를 효율적으로 사용하기 위해서 가상 네트워크를 필요한만큼 잘라서 사용하는 것을 말합니다.
- CloudStudio에서는 서브넷 이름이 고정된 서비스를 서브넷과 묶어서 제공합니다. 
  - ex) Application Gateway, Bastion Host, Firewall, Virtual Network Gateway
- 랜딩존 Basic은 방화벽만 사용하기 때문에 나머지 서브넷 4개를 추가로 생성합니다.
- Hub Vnet은 Subnet 5개를 생성합니다.
  - GatewaySubnet: <highlight color="#D0D0D0">10.0.0.0/24</highlight>
  - AzureBastionSubnet: <highlight color="#D0D0D0">10.0.1.0/24</highlight>
  - Jumpbox Subnet: <highlight color="#D0D0D0">10.0.2.0/24</highlight>
  - PrivateEndpoint Subnet: <highlight color="#D0D0D0">10.0.3.0/24</highlight>
  - AzureFirewallSubnet: <highlight color="#D0D0D0">10.0.4.0/26</highlight>
- Application Vnet은 Subnet 1개를 생성합니다.
  - Application Subnet: <highlight color="#D0D0D0">10.1.0.0/24</highlight>
<caption caption="[그림.6] Azure Landing Zone Basic 5" src={azLandingZoneBasic5} /><br/>
### 네트워크 보안 그룹 생성
- 네트워크 보안 그룹은 온프레미스 환경에서 방화벽 역할을합니다. 
- 네트워크 보안 그룹은 IP, Protocol, Port 번호로 트래픽을 허용 또는 차단합니다.
- 네트워크 보안 그룹은 서브넷 또는 네트워크 인터페이스에 연결할 수 있습니다.
- 네트워크 보안 그룹을 연결할 수 없는 방화벽을 제외하고 나머지 서브넷에 네트워크 보안 그룹을 생성 후 연결합니다.
- 같은 규칙을 사용한다면 네트워크 보안 그룹 1개가 여러 서브넷 이나 네트워크 인터페이스에 연결될 수 있습니다.
- 네트워크 보안 그룹에 사용할 규칙 - 사용자 정의
<caption caption="[그림.7] Azure Landing Zone Basic 6" src={azLandingZoneBasic6} /><br/>
### 방화벽 생성
- CloudStudio에서는 방화벽을 서브넷과 합쳐서 제공합니다.
- 방화벽에서는 Network, Application, NAT 3가지 규칙을 제공합니다.
- 사용자 환경에 맞는 방화벽 규칙을 설정합니다. - 사용자 정의
<caption caption="[그림.8] Azure Landing Zone Basic 7" src={azLandingZoneBasic7} /><br/>
### 가상 머신 생성
- 애플리케이션이 동작할 가상 머신을 생성합니다.
- 가상 머신의 SKU와 OS 버전을 설정합니다.
- 해당 가상 머신에 공인 IP 주소를 할당할지를 설정합니다.
  - Pip Enable을 false로 설정합니다.
  - 공인 IP를 사용하지 않는 경우, Pip Sku와 Pip Allocation Method는 설정하지 않아도 됩니다.
- 서브넷에서 가상 머신이 사용할 사설 IP 주소를 설정할 수 있습니다.
  - 사설 IP 주소를 설정하지 않는 경우, 사설 IP가 Dynamic으로 할당됩니다.
  - 사설 IP 주로슷 설정한 경우, 사설 IP가 Static으로 할당됩니다.
  - 사설 IP를 입력하는 경우, 서브넷에서 앞에 3개의 IP는 사용할 수 없습니다.
  - ex) Application Subnet의 가상 머신은 <highlight color="#D0D0D0">10.1.0.4</highlight> 부터 사설 IP를 설정 가능합니다.
<caption caption="[그림.9] Azure Landing Zone Basic 8" src={azLandingZoneBasic8} /><br/>
### 스토리지 계정 생성
- Azure에서 제공하는 Object 스토리지 입니다.
- 스토리지 계정은 Container, Queue, File, Table 4개 스토리지가 있습니다.
- 사용자는 필요한 유형의 스토리지를 생성 후 사용 가능합니다.
- 스토리지 계정의 Network Rules에서는 스토리지 계정에 접근 가능한 접근 IP 통제를 지원합니다.
- 사용자의 공인 IP만 접근 가능하도록 Network Rules을 설정합니다.
<caption caption="[그림.10] Azure Landing Zone Basic 9" src={azLandingZoneBasic9} /><br/>
### Key Vault 생성
- Azure에서 제공하는 Key Management Service입니다.
- Key Vault에는 Key, Secrets, Certificate를 등록해서 사용할 수 있습니다.
- 사용자가 필요한 Secret을 Key Vault에 저장합니다.
- Key Vault의 Network ACL에서는 Key Vault에 대한 접근 IP 통제를 지원합니다.
- Key Vault의 Access Policy에서는 Key Vault에 접근 가능한 사용자 통제를 지원합니다.
<caption caption="[그림.11] Azure Landing Zone Basic 10" src={azLandingZoneBasic10} /><br/>
### Automation Account 생성
- Automation은 클라우드 운영세어 배포 및 관리, 응답, 오케스트레이션을 담당합니다.
- Automation은 프로세스 자동화를 지원하는 Runbook과 구성 관리를 지원하는 DSC로 구성됩니다.
- Automation이 작업을 실행하기 위해 필요한 Secret 값은 Credential에 입력합니다.
- 프로세스 자동화를 위해 필요한 코드의 유형과 저장된 URI를 Runbook에 입력합니다.
- Automation이 사용자가 등록한 프로세스를 언재 실행할지 Schedule에서 지정합니다.
- Automation이 공통으로 사용하는 변수를 Variable에 등록합니다.
- Configuration에 구성 관리할 대상(가상 머신 등)과 관련된 Content를 입력합니다.
<caption caption="[그림.12] Azure Landing Zone Basic 11" src={azLandingZoneBasic11} /><br/>


*****

## 참고 자료



